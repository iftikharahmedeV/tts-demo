<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech Webpage</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* Custom spinner for loading state */
        .loader {
            width: 24px;
            height: 24px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #fff;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Container -->
    <div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-2xl w-full">

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900">Text to Speech</h1>
            <p class="mt-2 text-lg text-gray-500">Generate high-quality speech from text.</p>
        </div>

        <!-- Textarea for input -->
        <div class="mb-6">
            <label for="text-input" class="block text-sm font-medium text-gray-700 mb-2">Enter Text Here</label>
            <textarea id="text-input"
                      class="w-full h-40 p-4 border border-gray-300 rounded-xl shadow-inner resize-none
                             focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200
                             placeholder-gray-400 text-gray-800"
                      placeholder="Type or paste your text here..."
            ></textarea>
        </div>

        <!-- Action Buttons and Status -->
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <!-- Generate Button -->
            <button id="generate-btn"
                    class="w-full sm:w-auto flex-grow-0 px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600
                           text-white font-semibold rounded-full shadow-lg hover:from-blue-600
                           hover:to-purple-700 transform transition-all duration-300
                           active:scale-95 flex items-center justify-center gap-2"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
                <span>Generate Speech</span>
            </button>

            <!-- Loading Spinner -->
            <div id="loading-spinner" class="hidden">
                <div class="loader"></div>
            </div>
        </div>
        
        <!-- Error Message -->
        <div id="error-message" class="mt-4 text-center text-red-600 font-medium hidden"></div>

        <!-- Audio Player -->
        <div id="audio-container" class="mt-8 hidden">
            <h2 class="text-lg font-semibold text-gray-900 mb-2">Audio Playback</h2>
            <audio id="audio-player" controls class="w-full rounded-full shadow-sm"></audio>
        </div>
    </div>

    <script>
        // DOM element references
        const textInput = document.getElementById('text-input');
        const generateBtn = document.getElementById('generate-btn');
        const loadingSpinner = document.getElementById('loading-spinner');
        const audioContainer = document.getElementById('audio-container');
        const audioPlayer = document.getElementById('audio-player');
        const errorMessage = document.getElementById('error-message');

        // Event listener for the generate button
        generateBtn.addEventListener('click', async () => {
            const text = textInput.value.trim();
            if (text.length === 0) {
                errorMessage.textContent = 'Please enter some text to generate speech.';
                errorMessage.classList.remove('hidden');
                return;
            }

            // Disable button and show loading state
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<div class="loader"></div>';
            loadingSpinner.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            audioContainer.classList.add('hidden');
            audioPlayer.src = '';

            try {
                // 1. Define your ElevenLabs API key and voice ID here
                const elevenLabsApiKey = 'sk_113b972a23e151f6c8a3b21eca2800f1c89491819fa2ab4c'; // <<< REPLACE WITH YOUR API KEY
                const elevenLabsVoiceId = 'QjQm2hxRKqXbBJRCJDMt'; // <<< REPLACE WITH YOUR VOICE ID
                
                // 2. Construct the API payload and headers for ElevenLabs
                const url = `https://api.elevenlabs.io/v1/text-to-speech/${elevenLabsVoiceId}`;
                const headers = {
                    'Content-Type': 'application/json',
                    'xi-api-key': elevenLabsApiKey
                };

                // The payload now includes the settings from your image.
                const body = JSON.stringify({
                    text: text,
                    // The model is set to "Eleven Multilingual v2" as shown in your image.
                    model_id: 'eleven_multilingual_v2',
                    voice_settings: {
                        // These values are based on the slider positions in your image.
                        stability: 0.41,
                        similarity_boost: 1.0,
                        style: 0.11,
                        speed: 1.0,
                        use_speaker_boost: true
                    }
                });

                // 3. Make the fetch call to ElevenLabs and get the audio blob
                const response = await fetch(url, { method: 'POST', headers, body });
                
                // Check if the response is OK before proceeding
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const audioBlob = await response.blob();

                // 4. Create a URL from the blob and set it as the audio player's source
                const audioUrl = URL.createObjectURL(audioBlob);
                audioPlayer.src = audioUrl;
                audioContainer.classList.remove('hidden');

            } catch (error) {
                console.error('Error generating speech:', error);
                errorMessage.textContent = 'An error occurred. Please check your API key, voice ID, and settings.';
                errorMessage.classList.remove('hidden');
            } finally {
                // Re-enable button and hide loading state
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg><span>Generate Speech</span>';
                loadingSpinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
